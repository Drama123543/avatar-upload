var avatarUpload=function(e){function t(){g.click()}function i(e){var t=g[0].files;if(0!==t.length){"[object Function]"===Object.prototype.toString.call(e)&&e();var i=t[0];p={origin:{width:0,height:0},scale:1,move:{x:0,y:0},tempScale:0,tempMove:{x:0,y:0}},d&&window.URL.revokeObjectURL(d),d=window.URL.createObjectURL(i),$("#pictureUpload-bg").css("backgroundImage",'url("'+d+'")');var n=new Image;n.src=d,n.onload=function(){p.origin.width=n.width,p.origin.height=n.height}}}function n(e){h.width=l,h.height=m;var t=h.getContext("2d"),i=new Image;i.src=d,i.onload=function(){var n,o,c=a,g=r;p.origin.width>=p.origin.height?g=a/p.origin.width*p.origin.height:p.origin.width<p.origin.height&&(c=r/p.origin.height*p.origin.width),n=(l-c*p.scale)/2+p.move.x,o=(m-g*p.scale)/2+p.move.y,t.drawImage(i,0,0,i.width,i.height,n,o,c*p.scale,g*p.scale),"[object Function]"===Object.prototype.toString.call(e)&&e()}}function o(t){n(function(){h.toBlob(function(e){"[object Function]"===Object.prototype.toString.call(t)&&t(e)},"image/jpeg",e.imgQuality)})}function c(t,i,o){n(function(){h.toBlob(function(e){var n;if(document.getElementById(t))n=document.getElementById(t);else{var n=document.createElement("a");n.id=t,document.getElementById(i).appendChild(n)}for(var c=e.size,a=c+" bytes",r=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],l=0,m=c/1024;m>1;m/=1024,l++)a=m.toFixed(3)+" "+r[l]+" ("+c+" bytes)";n.textContent="Download("+a+")",n.href=window.URL.createObjectURL(e),n.download=o+".jpg"},"image/jpeg",e.imgQuality)})}var a=e.container.width,r=e.container.height,l=e.clip.width,m=e.clip.height,g=$(e.fileId),d="",h=$(e.canvasId)[0],p={origin:{width:0,height:0},scale:1,move:{x:0,y:0},tempScale:0,tempMove:{x:0,y:0}},v=new Hammer($(e.containerId)[0]),s=new Hammer.Pan,u=new Hammer.Pinch,w=$(e.uploadBgId);return v.add([s,u]),v.on("pinchstart",function(e){p.tempScale=e.scale}),v.on("pinchmove",function(e){p.scale=e.scale-p.tempScale+p.scale,p.tempScale=e.scale,w.css("transform","scale("+p.scale+","+p.scale+")")}),v.on("panstart",function(e){var t=e.center.x,i=e.center.y;p.tempMove.x=t,p.tempMove.y=i}),v.on("panmove",function(e){var t=e.center.x,i=e.center.y,n=t-p.tempMove.x,o=i-p.tempMove.y;p.move.x=p.move.x+n,p.move.y=p.move.y+o,p.tempMove.x=t,p.tempMove.y=i,w.css({left:p.move.x+"px",top:p.move.y+"px"})}),{selectImg:t,handleFiles:i,createImg:n,submit:o,imgData:p,createLocalImg:c}};